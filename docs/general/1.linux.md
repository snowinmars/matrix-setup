[English](1.linux.md) | [Русский](1.linux.ru.md)

# Linux

Just use linux. It's possible to run this system on windows, but don't.

    In this section use the following substitution:

    - 🕷 $USERNAME: your_linux_username

## User

1. `adduser 🕷 <USERNAME>` - create new user to separate everyday stuff and the work 
1. `sudo adduser 🕷 <USERNAME> sudo` - add user to sudoers
1. Relogin as the new user

## Docker

1. Install [docker compose](https://docs.docker.com/compose/install/)
1. `sudo usermod -aG docker $USER` - add the user to the docker group
1. Relogin to apply changes

## Ssh

    Beware:
        if you are using remote access and 
            if you misconfigurate something in ssh,
    you will loose access to the target PC forever

Install [ssh server](https://wiki.archlinux.org/title/OpenSSH) to the host PC.

Do read the following articles:
* [ssh server guide](https://wiki.archlinux.org/title/OpenSSH#Force_public_key_authentication)
* [ssh keys guide](https://wiki.archlinux.org/title/SSH_keys)
* [sshd config man](https://www.ssh.com/academy/ssh/sshd_config)

Do not do anything before you read them.

Read them while doing stuff.

Ok, follow the rules from the guides, but long story short: 

1. Change ssh port in `/etc/ssh/sshd_config` to something from `30000` to `50000`

    This is security though obsucurity which is not ideal but port `22` just gets abused by bots. Futhermore, you future site address will be the same as ssh entrypoint address
1. Disable ssh by password:
    ```
    # /etc/ssh/sshd_config`
    
    PermitRootLogin         no
    PasswordAuthentication  no
    PermitEmptyPasswords    no
    PubkeyAuthentication    yes
    AuthenticationMethods   publickey
    ```
1. `ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa -N your_passphrase` - create ssh pair **with** passphrase. Remember, that you can always change the passphrase with `ssh-keygen -f ~/.ssh/id_rsa -p`
1. Ensure that the keys have `chmod 600`
1. Copy the keys to the corresponding locations:
    1. `~/.ssh/id_rsa.pub` should be on server and should not be on client PC
    2. `~/.ssh/id_rsa` should be on client and should not be on server PC
1. On the server, set public key path in the `/etc/ssh/sshd_config`
1. `sudo systemctl restart sshd` - restart ssh
1. Reconnected? Good.

## fail2ban

Install and configure [uwf](https://wiki.archlinux.org/title/Fail2ban) to prevent dos attacks.

## Optional: uwf

You'll need something to handle ports. Install and configure [uwf](https://wiki.archlinux.org/title/Uncomplicated_Firewall), if you like it. Or use another method to open ports.

# Next

* [partitions guide](2.partitions.md)
