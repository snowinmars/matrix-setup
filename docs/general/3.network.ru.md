[English](3.network.md) | [Русский](3.network.ru.md)

Требования:

* [готовый к бою линукс](1.linux.ru.md)
    * [возможно, на шифрованном разделе](2.partitions.ru.md)

# Сеть

## Порты

    Если порт открыт, но на нём никто не слушает, порт выглядит закрытым.

Ща понадобится открывать порты. Давай тренироваться на, например, порту 51820.

1. В `ufw`
    1. `sudo ufw allow 51820/tcp`
    1. `sudo ufw allow 51820/udp`
    1. `sudo ufw enable`

Теперь выполняй команды в двух терминалах рядом:

- в одном терминале:
    - `nc -lp 51820` - выходить по Ctrl+C
- в другом терминале убедись, что порт находится в состоянии LISTEN:
    - `sudo iptables -L` - должен выдать 51820 tcp/udp in and out
    - `sudo netstat -tulpn` - должен выдать 51820 tcp/udp in and out
    - `sudo ufw status` - должен выдать 51820 tcp/udp in and out
    - `sudo ufw listening` - запустит слушателя; выходить по Ctrl+C

- в одном терминале:
    - `nc -lup 51820`
- в другом терминале:
    - `sudo ufw listening`

Если всё работает, то порт на самом ПК открыт. Теперь надо открыть порт в ближайшей локальной сети.

- `ifconfig` - адаптер покажет локальный ip, например, `192.168.0.101`
- в настройках роутера зафорварди порт 51820 на 192.168.0.101:51820. Некоторые роутеры, кстати, сами подскажут тебе твой локальный ip
- в одном терминале:
    - `nc -lp 51820`
- в другом терминале:
    - `telnet 192.168.0.101 51820` - по идее, ты должен напечатать что-то и нажать Enter. Строчка провалится в первый терминал, в слушателя

Чтобы уж наверняка - с другого компа **в той же локалке (в той же квартире)** выполни команду со второго терминала. 

Если строчка летает - порт открыт в пределах локальной сети.

Интернет фрактален. Повторяй эти шаги, открывая порты всё в более высоких сетях (если они есть), заканчивая своим публичным ip:

- пусть публичный ip будет, скажем, 215.201.5.110
- в одном терминале:
  - `nc -lp 51820`
- в другом терминале:
  - `telnet 215.201.5.110 51820`

Если строчка всё ещё прыгает, то шикардос, идём дальше. Но на всякий случай проверь онлайн чекером, что порт открыт.

Если чего не работает - сделай работать. Открытие портов будет нужно.

# Далее

* [настройка nginx](4.nginx.ru.md)
