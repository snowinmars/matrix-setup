[English](1.linux.md) | [Русский](1.linux.ru.md)

# Линукс

Просто линукс. Хотя всё это можно поднять и на винде, не надо этого делать.

    В этой инструкции будут использованы следующие переменные:

    - 🕷 $USERNAME: your_linux_username

## Юзер

1. `adduser 🕷 <USERNAME>` - не ленись: мухи - отдельно, котлеты - отдельно
1. `sudo adduser 🕷 <USERNAME> sudo` - добавь юзера в sudoers
1. Релогинься из-под нового юзера

## Docker

1. Поставь [docker compose](https://docs.docker.com/compose/install/)
1. `sudo usermod -aG docker $USER` - добавь юзера в группу докера
1. Релогинься, чтобы применить изменения

## Ssh

    Важновое:
        если ты сидишь на компе по удалёнке,
            и если ты ошибёшься в конфиге ssh,
    ты потеряешь доступ к хосту навсегда

Поставь [ssh server](https://wiki.archlinux.org/title/OpenSSH) на хост.

Прочитай статьи:
* [ssh server guide](https://wiki.archlinux.org/title/OpenSSH#Force_public_key_authentication)
* [ssh keys guide](https://wiki.archlinux.org/title/SSH_keys)
* [sshd config man](https://www.ssh.com/academy/ssh/sshd_config)

Ничего не делай, пока их не прочитаешь.

Читай, пока делаешь.

В целом, следуй инструкциям, но краткую выжимку оставлю здесь:

1. Смени порт ssh в `/etc/ssh/sshd_config` на какой-нибудь из диапазона `30000` .. `50000`

    На `22` стучатся боты, да и в целом светиться лучше поменьше. К тому же, адрес твоего будущего сайта будет такой же, как и у ssh сервера 
1. Выключи авторизацию по паролю:
    ```
    # /etc/ssh/sshd_config`
    
    PermitRootLogin         no
    PasswordAuthentication  no
    PermitEmptyPasswords    no
    PubkeyAuthentication    yes
    AuthenticationMethods   publickey
    ```
1. `ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa -N your_passphrase` - создай ключи **с** паролем. Его, кстати, всегда можно сменить: `ssh-keygen -f ~/.ssh/id_rsa -p`
1. Убедись, что у ключей нормальный `chmod 600`
1. Скопируй ключи в положенные им места:
    1. `~/.ssh/id_rsa.pub` - на сервер и не на клиента
    2. `~/.ssh/id_rsa` - на клиента и не на сервер
1. На сервере добавь ключ в `/etc/ssh/sshd_config`
1. `sudo systemctl restart sshd` - рестартани ssh
1. Живой? Супер.

## fail2ban

Поставь и настрой [uwf](https://wiki.archlinux.org/title/Fail2ban) - защита от простеньких dos атак.

## По желанию: uwf

Скоро надо будет открывать порты. Если нравится [uwf](https://wiki.archlinux.org/title/Uncomplicated_Firewall) - поставь и сконфигурируй. Если не нравится - приготовь другой инструмент.

# Далее

* [разделы](2.partitions.ru.md)
